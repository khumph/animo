---
title: "ANIMO efficacy outcome tables"
author: "Kyle Humphrey"
date: "`r format(Sys.time(), '%B %e %Y')`"
output: html_document
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../results") })
---

```{r setup, echo = F, warning = F, message = F}
rm(list = ls())
knitr::opts_chunk$set(
  echo = F,
  warning = F,
  message = F,
  root.dir = '..'
)
knitr::opts_knit$set(root.dir = '..')
pacman::p_load(tidyverse, htmlTable)
select <- dplyr::select
```

```{r load table data}
tabs <- read_rds("./results/efficacy-tables-data.rds")
```

```{r}
html_table_base <- function(tab, ...) {
  column_labels <- c("Baseline", "Week 12", "Week 24",
                     "Week 12 - Baseline",
                     "Baseline", "Week 12<sup>b</sup>")
  column_groups <- c("Mean<sup>a</sup> (95% CI)",
                     "Mean change from baseline (95% CI), p-value",
                     "Mean differences between groups (95% CI), p-value")

  htmlTable(
    tab %>% select(-label, -group) %>% as.matrix(),
    cgroup = column_groups,
    n.cgroup = c(3, 1, 2),
    rnames = tab$group,
    rgroup = tab$label %>% unique(),
    n.rgroup =  count(group_by(tab, label))$n,
    header = column_labels,
    ,
    ...
  )
}
```


```{r macro mean table}
html_table_base(
  tabs$macro,
  caption = "Table XX: Estimates and 95% confidence intervals for mean weight, body composition, physical activity, and daily caloric intake, as well as changes in these mean measures from baseline, and mean differences between groups.",
  tfoot = paste0(
    "<sup>a</sup>Means were estimated by contrasts in each model\n",
    "<sup>b</sup>Difference in change from baseline between groups at week 12\n",
    "<sup>c</sup>The number of observations available for some outcomes were one below or above the values given\n",
    "<sup>d</sup>Lesiure time physical activity.\n",
    "<sup>e</sup>Differences in caloric intake are percent differences, and (for the last column) percent difference in ratio of mean week 12 to mean baseline measurements"
  ))
```


```{r cardiometabolic table}
html_table_base(
  tabs$blood,
  caption = "Table XX: Estimates and 95% confidence intervals for mean cardiometabolic measures, changes in mean measures from baseline, and mean differences between groups. Units for means and SDs are mg/dL, with the exception of HbA1c, which has units of DCCT %.",
  tfoot = paste0(
      "<sup>a</sup>Geometric means, estimated by contrasts in each model\n",
      "<sup>b</sup>Percent difference in the ratio of mean week 12 to mean baseline measurements\n",
      "<sup>c</sup>The number of observations available for some outcomes were one below or above the values given\n"
    )
)
```

