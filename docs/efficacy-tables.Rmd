---
title: "ANIMO efficacy outcome tables"
author: "Kyle Humphrey"
date: "`r format(Sys.time(), '%B %e %Y')`"
output: html_document
params: 
  input_data: "default"
---

```{r setup, echo = F, warning = F, message = F}
knitr::opts_chunk$set(
  echo = F,
  warning = F,
  message = F,
  root.dir = '..'
)
knitr::opts_knit$set(root.dir = '..')
pacman::p_load(tidyverse, htmlTable)
```

```{r load table data}
tabs <- read_rds(params$input_data)
```

```{r}
html_table_base <- function(tab, ...) {
  column_labels <- c("Baseline", "Week 12", "Week 24",
                     "Week 12 - Baseline",
                     "Baseline", "Week 12<sup>b</sup>")
  column_groups <- c("Mean<sup>a</sup> (95% CI)",
                     "Mean change from baseline (95% CI), p-value",
                     "Mean differences between groups (95% CI), p-value")

  htmlTable(
    tab %>% select(-label, -group) %>% as.matrix(),
    cgroup = column_groups,
    n.cgroup = c(3, 1, 2),
    rnames = tab$group,
    rgroup = tab$label %>% unique(),
    n.rgroup =  count(group_by(tab, label))$n,
    header = column_labels,
    ,
    ...
  )
}
```

_Study retention, weight loss, physical activity, and dietary change_  
Forty-three of 50 participants completed the main 12-week assessments, an overall attrition rate of 14% (GCSWLI: n = 5, 20% vs. WLC: n = 2, 8%). As shown in table XX, mean weight loss in the GCSWLI group was 6.2 kg (95% CI (4.4, 8.14)) from baseline to week 12 compared to 0.8 kg (95% CI (0.94, 2.5), p = 0.37) for the WLC group over the same period (difference = -5.4 kg, 95% CI (-8.0, -2.9), p < 0.01). 44% (n = 11) of GCSWLI participants achieved a 5% weight loss by week 12 compared to 4% (n = 1) in the WLC (p < 0.01). Mean waist circumference and mean percent body fat both decreased significantly from baseline to week 12 in the GCSWLI group (waist circumference: 4.7 cm decrease, 95% CI (3.1, 6.2), p < 0.01; percent body fat: 1.6% decrease, 95% CI (0.89, 2.4), p < 0.01), and these changes were significantly greater in the GCSWLI group than in the WLC group (waist circumference: 4.3 cm greater decrease in GCSWLI, 95% CI (2.1, 6.4), p < 0.01; body fat percentage: 1.1% greater decrease in GCSWLI, 95% CI (0.08, 2.2), p = 0.035). Mean leisure time physical activity (LTPA) for GCSWLI participants increased by 183 minutes/week (95% CI (-26, 392), p = 0.087) from baseline to week 12, a 144 minutes/week (95% CI (-145, 433), p = 0.33) greater increase than in the WLC group over the same period. The distribution of LTPA was right skewed with many participants reporting no activity, so a Wilcoxon rank sum test (comparing the change from baseline between groups) and Wilcoxon signed rank tests (comparing change from baseline within each group) were performed as a sensitivity analysis. The results of these tests agreed with results of the primary analysis described above. Mean caloric dietary intake in the GCSWLI group decreased by 51.3% (95% CI (36.7, 62.6), p < 0.01) from baseline to week 12, a 38.3% (95% CI (11.4, 57.1), p < 0.01) greater decrease relative to the baseline in the GCSWLI than the WLC group. All mean changes from baseline to week 12 for the above outcomes were maintained through week 24 in the GCSWLI group.


```{r macro mean table}
html_table_base(
  tabs$macro,
  caption = "Table XX: Estimates and 95% confidence intervals for mean weight, body composition, physical activity, and daily caloric intake, as well as changes in these mean measures from baseline, and mean differences between groups.",
  tfoot = paste0(
    "<sup>a</sup>Means were estimated by contrasts in each model\n",
    "<sup>b</sup>Difference in change from baseline between groups at week 12\n",
    "<sup>c</sup>The number of observations available for some outcomes were one below or above the values given\n",
    "<sup>d</sup>Lesiure time physical activity.\n",
    "<sup>e</sup>Differences in caloric intake are percent differences, and (for the last column) percent difference in ratio of mean week 12 to mean baseline measurements"
  ))
```

_Cardiometabolic measures_  
As shown in table XX, HbA1c decreased by 0.25 DCCT % (4.3% decrease, 95% (2.5, 6.0), p < 0.01) from baseline to week 12 in the GCSWLI group, a relative decrease from baseline 3.1% (95% CI (0.6, 5.5), p = 0.014) greater than in the WLC. Serum alanine transferase (ALT) and serum aspartate aminotransferase (AST) decreased significantly in both groups from baseline to week 12. However, the mean ALT at week 12 relative to baseline was 7.6% greater (95% CI (23.0, -10.8), p = 0.39) in the GCSWLI group than WLC group. There were no significant mean changes in cholesterol over the study period for either group, though HDL cholesterol at week 12 relative to baseline was 8.5% (95% CI (0.5, 15.8), p = 0.038) less in the GCSWLI group, equalizing a baseline difference between the groups. Mean serum triglycerides decreased in the GCSWLI by 23 mg/dL (16.1%, 95% CI (29.0, 0.7), p = 0.041) from baseline to week 12, and the mean at week 12 relative to baseline was 20.3% less (95% CI (-0.4, 36.7), p = 0.054) than that in the WLC. Serum high sensitivity C-reactive protein (hs-CRP) did not change significantly in the GCSWLI group, but did increase significantly in the WLC, with the week 12 mean being 34.8% greater than baseline (95% CI (8.0, 68.3), p < 0.01).

```{r cardiometabolic table}
html_table_base(
  tabs$blood,
  caption = "Table XX: Estimates and 95% confidence intervals for mean cardiometabolic measures, changes in mean measures from baseline, and mean differences between groups. Units for means and SDs are mg/dL, with the exception of HbA1c, which has units of DCCT %.",
  tfoot = paste0(
      "<sup>a</sup>Geometric means, estimated by contrasts in each model\n",
      "<sup>b</sup>Percent difference in the ratio of mean week 12 to mean baseline measurements\n",
      "<sup>c</sup>The number of observations available for some outcomes were one below or above the values given\n"
    )
)
```

