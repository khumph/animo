---
title: "ANIMO efficacy outcome Tables"
author: "Kyle Humphrey"
date: "`r format(Sys.time(), '%B %d %Y')`"
output: html_document
knit: (function(inputFile, encoding) {
  rmarkdown::render(inputFile, encoding = encoding, output_dir = "../results") })
editor_options: 
  chunk_output_type: console
---

```{r setup, echo = F, warning = F, message = F}
source("setup-cleaning.R")
rm(list = ls())
load("../data/animo-cleaned.Rdata")
```

```{r table functions}
source("table-functions.R")
```

```{r contrasts}
source("contrasts.R")
```

```{r blood results}
source("blood-models.R")
```

```{r cardiometabolic table}
blood_results$means %>%
  full_join(blood_results$diffs_base, by = c("variable", "Group")) %>%
  full_join(blood_results$diffs_grps, by = c("variable", "Group")) %>%
  select(-variable, -Group) %>%
  as.matrix() %>%
  `colnames<-`(c(
    "Baseline",
    "Week 12",
    "Week 24",
    "Week 12 - Baseline",
    "Baseline",
    "Week 12<sup>a</sup>"
  )) %>% 
  htmlTable(
    rnames = rep(c("WLC", "GSCWLI"), nrow(.)/2),
    rgroup = blood_labels %>% flatten_chr() %>% rep(2),
    n.rgroup = rep(2, nrow(.) / 2),
    cgroup = c("Mean assessments", "Percent change from baseline",
               "Percent differences between groups"),
    n.cgroup = c(3, 1, 2),
    caption = "Table XX: Cardiometabolic measures.",
    tfoot = "<sup>a</sup> Difference in change from baseline between groups at week 12"
  )
```

```{r macro measures variables and labels}
macro_labels <- tibble(
  weight = "Weight (kg)",
  `log(weight)` = "Percent weight change",
  waist = "Waist circumference (cm)",
  pct_fat = "Percent body fat",
  `log(total_PA_minutes + 1)` = "LTPA<sup>a</sup> (minutes/week)",
  kcals_per_day = "Average caloric intake (kcal/day)"
)
```

```{r macro models}
source("macro-models.R")
```

```{r macro mean table}
macro_results$means %>%
  # remove means of percent weight beacuse they're geo means 
  # not means of percent weight change
  mutate(Baseline = ifelse(variable == "log(weight)", NA, Baseline),
         `Week 12` = ifelse(variable == "log(weight)", NA, `Week 12`),
         `Week 24` = ifelse(variable == "log(weight)", NA, `Week 24`),) %>% 
  full_join(macro_results$diffs_base, by = c("variable", "Group")) %>%
  full_join(macro_results$diffs_grps, by = c("variable", "Group")) %>%
  select(-variable, -Group) %>%
  as.matrix() %>%
  `colnames<-`(c(
    "Baseline",
    "Week 12",
    "Week 24",
    "Week 12 - Baseline",
    "Baseline",
    "Week 12<sup>b</sup>"
  )) %>% 
  htmlTable(
    rnames = rep(c("WLC", "GSCWLI"), nrow(.)/2),
    rgroup = macro_labels %>% flatten_chr() %>% rep(2),
    n.rgroup = rep(2, nrow(.) / 2),
    cgroup = c("Mean assessments", "Change from baseline",
               "Differences between groups"),
    n.cgroup = c(3, 1, 2),
    caption = "Table XX: measures.",
    tfoot = "<sup>a</sup> Lesiure time physical activity. Means given are geometric means, differences are percent differences.\n<sup>b</sup>Difference in change from baseline between groups at week 12"
  )
```
